<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to shinymeta • shinymeta</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to shinymeta">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">shinymeta</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/shinymeta.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to shinymeta</h1>
                        <h4 class="author">Joe Cheng</h4>
            
            <h4 class="date">2019-06-03</h4>
      
      
      <div class="hidden name"><code>shinymeta.Rmd</code></div>

    </div>

    
    
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p>Fundamental tension between interactive processes and reproducibility. One solution is to use interactive processes to generate a reproducible artifact. (Doesn’t solve the problem of “how you got there” though.)</p>
</div>
<div id="other-approaches-scriptgloss-phyloseq" class="section level2">
<h2 class="hasAnchor">
<a href="#other-approaches-scriptgloss-phyloseq" class="anchor"></a>Other approaches (scriptgloss, phyloseq)</h2>
<p>Tradeoffs exist between ease-of-use and quality/clarity of code. All existing approaches are far from perfect IMHO, including the one I am presenting today.</p>
</div>
<div id="demo" class="section level2">
<h2 class="hasAnchor">
<a href="#demo" class="anchor"></a>Demo</h2>
<p>I can use this Shiny app interactively, there’s a code preview window, and I can click this button to download a source .R or .Rmd.</p>
</div>
<div id="code" class="section level2">
<h2 class="hasAnchor">
<a href="#code" class="anchor"></a>Code</h2>
<p>As you can see, the code is all relatively concise, but it does involve some weird syntax. Not your typical Shiny reactives.</p>
<p>Now let’s talk about what these pieces are, and how to put them together.</p>
</div>
<div id="metaprogramming-with-shiny" class="section level2">
<h2 class="hasAnchor">
<a href="#metaprogramming-with-shiny" class="anchor"></a>Metaprogramming with Shiny</h2>
<p>Regular programming is writing code that generates actions and results.</p>
<p>Metaprogramming is writing code that generates code.</p>
<pre><code>regular_function() =&gt; data frame, model object, plotting to graphics device
meta_function() =&gt; code</code></pre>
<p>By “code” I don’t mean a string, but rather, R’s built-in data type for code (expressions).</p>
<pre><code>Characters =parse()=&gt; Expressions =eval()=&gt; Results</code></pre>
<p><strong>Hypothesis:</strong> Let Shiny app authors write logic that is suitable for both execution (for interactive use) and exporting (for generating reproducible artifacts).</p>
<div id="quotingunquoting" class="section level3">
<h3 class="hasAnchor">
<a href="#quotingunquoting" class="anchor"></a>Quoting/unquoting</h3>
<p>In general terms, “quoting” is how we tell the compiler/interpreter “don’t evaluate this!”</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># This is a comment</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">"# This is not a comment, because quotes"</span></a></code></pre></div>
<pre><code>#&gt; [1] "# This is not a comment, because quotes"</code></pre>
<p>The preceding is an example of string quoting–that’s what double-quote and single-quote characters do.</p>
<p>The equivalent for metaprogramming is quoting code; instead of using double-quotes to mark a sequence of characters as a string, we use <code><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote()</a></code> (or <code><a href="https://rlang.r-lib.org/reference/quotation.html">rlang::expr()</a></code>, if you prefer) to mark an expression as code.</p>
<p><code><a href="https://www.rdocumentation.org/packages/utils/topics/str">str(cars)</a></code> will cause the structure of cars to be printed, but <code><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote(str(cars))</a></code> will just return the <em>code</em> for <code><a href="https://www.rdocumentation.org/packages/utils/topics/str">str(cars)</a></code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(cars)</a></code></pre></div>
<pre><code>#&gt; 'data.frame':    50 obs. of  2 variables:
#&gt;  $ speed: num  4 4 7 7 8 9 10 10 10 11 ...
#&gt;  $ dist : num  2 10 4 22 16 10 18 26 34 17 ...</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/str">str</a></span>(cars))</a></code></pre></div>
<pre><code>#&gt; str(cars)</code></pre>
<p>(to be continued)</p>
</div>
</div>
<div id="specifics-of-metaprogramming-with-shiny" class="section level2">
<h2 class="hasAnchor">
<a href="#specifics-of-metaprogramming-with-shiny" class="anchor"></a>Specifics of metaprogramming with Shiny</h2>
<p>There are several types of code in Shiny that you might want to export.</p>
<ol style="list-style-type: decimal">
<li>
<strong>Top-level functions:</strong> write these in a separate file (functions.R)</li>
<li>
<strong>Reactive expressions:</strong> use metaReactive or metaReactive2</li>
<li>
<strong>Observers and outputs:</strong> extract bodies into metaAction</li>
<li>
<strong>eventReactive/observeEvent:</strong> ??? Probably will need metaEventReactive, that in meta mode only returns the body? For now just use regular metaReactive2 with isolate</li>
</ol>
<div id="using-metareactive" class="section level3">
<h3 class="hasAnchor">
<a href="#using-metareactive" class="anchor"></a>Using <code>metaReactive</code>
</h3>
<p>A <code>metaReactive</code> is like a regular reactive expression, except for two differences.</p>
<p>First, a <code>metaReactive</code> can be called in two ways. If you call it the normal way, it calculates and returns a result as usual. But if you call it inside <code>withMetaMode(...)</code>, then instead of returning a result, it returns code.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(shiny)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(shinymeta)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co"># For demonstration purposes, suppress shiny's missing context error so we can walk through meta-programming in shiny *outside* of a shiny app</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/options">options</a></span>(<span class="dt">shiny.suppressMissingContextError=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8">input &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb9-9" title="9">  <span class="dt">url =</span> <span class="st">"https://raw.githubusercontent.com/rstudio/gt/master/data-raw/sza.csv"</span>,</a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="dt">rows =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb9-11" title="11">)</a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13">r &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>({</a>
<a class="sourceLine" id="cb9-14" title="14">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(input<span class="op">$</span>url) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(input<span class="op">$</span>rows)</a>
<a class="sourceLine" id="cb9-16" title="16">})</a></code></pre></div>
<pre><code>#&gt; Registered S3 method overwritten by 'fastmap':
#&gt;   method            from 
#&gt;   print.key_missing shiny</code></pre>
<p>If you call <code>r()</code> normally, it returns a data frame:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">r</span>()</a></code></pre></div>
<pre><code>#&gt;   latitude month tst sza
#&gt; 1       20   jan 400  NA
#&gt; 2       20   jan 430  NA
#&gt; 3       20   jan 500  NA
#&gt; 4       20   jan 530  NA
#&gt; 5       20   jan 600  NA</code></pre>
<p>But if you use <code>withMetaMode(r())</code>, it returns code:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">withMetaMode</span>(<span class="kw">r</span>())</a></code></pre></div>
<pre><code>#&gt; read.csv(input$url) %&gt;%
#&gt;   head(input$rows)</code></pre>
<p>Second, metaReactives are tidyeval aware, and use this capability to let you, the app author, perform some customization as to how the code should be rendered. Specifically, you can decide what parts of your code should appear in the output code verbatim, and which parts you want to replace with the value.</p>
<p>For example, in the previous example, do you want the output code to contain <code>input$url</code> and <code>input$rows</code>? Probably not, you want the actual values instead. In that case, you need to unquote <code>input$url</code> by changing it to <code>!!input$url</code>. This doesn’t result in any different behavior when calling the metaReactive normally, but when called inside <code>withMetaMode</code>, the code will have <code>input$url</code> replaced with its value.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">r &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>({</a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="op">!!</span>input<span class="op">$</span>url) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="op">!!</span>input<span class="op">$</span>rows)</a>
<a class="sourceLine" id="cb15-4" title="4">})</a>
<a class="sourceLine" id="cb15-5" title="5"></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="kw">r</span>()</a></code></pre></div>
<pre><code>#&gt;   latitude month tst sza
#&gt; 1       20   jan 400  NA
#&gt; 2       20   jan 430  NA
#&gt; 3       20   jan 500  NA
#&gt; 4       20   jan 530  NA
#&gt; 5       20   jan 600  NA</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">withMetaMode</span>(<span class="kw">r</span>())</a></code></pre></div>
<pre><code>#&gt; read.csv("https://raw.githubusercontent.com/rstudio/gt/master/data-raw/sza.csv") %&gt;%
#&gt;   head(5)</code></pre>
<p>Now, the actual URL and number of rows have been inserted into the code.</p>
</div>
<div id="using-metareactive2" class="section level3">
<h3 class="hasAnchor">
<a href="#using-metareactive2" class="anchor"></a>Using metaReactive2</h3>
<p>metaReactive is used when the entire body of code in the metaReactive should be exported. But what if you want just a subset of the code to be exported, i.e. some of the code is only for interactive use?</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">time &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>({</a>
<a class="sourceLine" id="cb19-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/invalidateLater">invalidateLater</a></span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb19-3" title="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>()</a>
<a class="sourceLine" id="cb19-4" title="4">})</a>
<a class="sourceLine" id="cb19-5" title="5"></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="kw">withMetaMode</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/time">time</a></span>())</a></code></pre></div>
<pre><code>#&gt; invalidateLater(1000)
#&gt; Sys.time()</code></pre>
<p>The output code contains <code><a href="https://www.rdocumentation.org/packages/shiny/topics/invalidateLater">invalidateLater(1000); Sys.time()</a></code>. Even though we need <code><a href="https://www.rdocumentation.org/packages/shiny/topics/invalidateLater">invalidateLater(1000)</a></code> for runtime purposes, we don’t want it to be in our reproducible script, only <code><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time()</a></code>. We can use <code>metaReactive2</code> (note: function name is subject to change!) instead:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">time &lt;-<span class="st"> </span><span class="kw">metaReactive2</span>({</a>
<a class="sourceLine" id="cb21-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/invalidateLater">invalidateLater</a></span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb21-3" title="3">  <span class="kw">metaExpr</span>({</a>
<a class="sourceLine" id="cb21-4" title="4">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>()</a>
<a class="sourceLine" id="cb21-5" title="5">  })</a>
<a class="sourceLine" id="cb21-6" title="6">})</a>
<a class="sourceLine" id="cb21-7" title="7"></a>
<a class="sourceLine" id="cb21-8" title="8"><span class="kw">withMetaMode</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/time">time</a></span>())</a></code></pre></div>
<pre><code>#&gt; Sys.time()</code></pre>
<p>When using <code>metaReactive2</code>, you wrap the code you care about in <code>metaExpr()</code> and return the result. (Exercise: What if you want the output code to contain the actual time, instead of a call to Sys.time()?)</p>
</div>
<div id="metareactives-calling-metareactives" class="section level3">
<h3 class="hasAnchor">
<a href="#metareactives-calling-metareactives" class="anchor"></a>metaReactives calling metaReactives</h3>
<p>Just as reactive expressions can call reactive expressions, metaReactives can call metaReactives.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">time &lt;-<span class="st"> </span><span class="kw">metaReactive2</span>({</a>
<a class="sourceLine" id="cb23-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/shiny/topics/invalidateLater">invalidateLater</a></span>(<span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb23-3" title="3">  <span class="kw">metaExpr</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time</a></span>())</a>
<a class="sourceLine" id="cb23-4" title="4">})</a>
<a class="sourceLine" id="cb23-5" title="5"></a>
<a class="sourceLine" id="cb23-6" title="6">tomorrow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>({</a>
<a class="sourceLine" id="cb23-7" title="7">  <span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/time">time</a></span>() <span class="op">+</span><span class="st"> </span>(<span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">24</span>)</a>
<a class="sourceLine" id="cb23-8" title="8">})</a>
<a class="sourceLine" id="cb23-9" title="9"></a>
<a class="sourceLine" id="cb23-10" title="10"><span class="kw">withMetaMode</span>(<span class="kw">tomorrow</span>())</a></code></pre></div>
<pre><code>#&gt; Sys.time() + (60 * 60 * 24)</code></pre>
<p>In this example, the tomorrow metaReactive calls the time metaReactive. Just like a regular reactive expression, we have to call time like a function.</p>
<p>Notice that calling <code>!!time()</code> turned into the code <code><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.time()</a></code>, instead of a value like <code>2019-06-03 11:43:01</code>. This may be surprising, because in the case of <code>!!input$url</code>, it turned into a value; why doesn’t <code>!!time()</code> do the same? The answer is, <code>time</code> is a metaReactive, and it too is being invoked inside of <code>withMetaMode</code> (albeit indirectly). And whenever a metaReactive is called within a <code>withMetaMode</code>, its return value is code. So <code>!!time()</code> <em>does</em> insert the “value”, so to speak, of <code>time</code>; it just so happens that, because we’re in <code>withMetaMode</code>, that value happens to be code.</p>
</div>
</div>
<div id="combining-multiple-code-objects-into-one-code-block" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-multiple-code-objects-into-one-code-block" class="anchor"></a>Combining multiple code objects into one code block</h2>
<p>Is this the best way?</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">a &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(foo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/grDevices/topics/plotmath">bar</a></span>())</a>
<a class="sourceLine" id="cb25-2" title="2">b &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(baz &lt;-<span class="st"> </span>qux)</a>
<a class="sourceLine" id="cb25-3" title="3"></a>
<a class="sourceLine" id="cb25-4" title="4">rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">expr</a></span>({</a>
<a class="sourceLine" id="cb25-5" title="5">  <span class="op">!!</span>a</a>
<a class="sourceLine" id="cb25-6" title="6">  <span class="op">!!</span>b</a>
<a class="sourceLine" id="cb25-7" title="7">})</a></code></pre></div>
<pre><code>#&gt; {
#&gt;     foo %&gt;% bar()
#&gt;     baz &lt;- qux
#&gt; }</code></pre>
<p>An alternative:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">join_code &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb27-2" title="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/call">as.call</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(<span class="st">`</span><span class="dt">{</span><span class="st">`</span>)), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(...)))</a>
<a class="sourceLine" id="cb27-3" title="3">}</a>
<a class="sourceLine" id="cb27-4" title="4"></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="kw">join_code</span>(a, b)</a></code></pre></div>
<pre><code>#&gt; {
#&gt;     foo %&gt;% bar()
#&gt;     baz &lt;- qux
#&gt; }</code></pre>
</div>
<div id="reducing-code-duplication" class="section level2">
<h2 class="hasAnchor">
<a href="#reducing-code-duplication" class="anchor"></a>Reducing code duplication</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">input &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">dataset =</span> <span class="st">"pressure"</span>)</a>
<a class="sourceLine" id="cb29-2" title="2"></a>
<a class="sourceLine" id="cb29-3" title="3">df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>(</a>
<a class="sourceLine" id="cb29-4" title="4">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/get">get</a></span>(<span class="op">!!</span>input<span class="op">$</span>dataset, <span class="st">"package:datasets"</span>)</a>
<a class="sourceLine" id="cb29-5" title="5">)</a>
<a class="sourceLine" id="cb29-6" title="6"></a>
<a class="sourceLine" id="cb29-7" title="7">first &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>(<span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Fdist">df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(1L))</a>
<a class="sourceLine" id="cb29-8" title="8">last &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>(<span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Fdist">df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(1L))</a>
<a class="sourceLine" id="cb29-9" title="9"></a>
<a class="sourceLine" id="cb29-10" title="10"><span class="kw">withMetaMode</span>(rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">expr</a></span>({</a>
<a class="sourceLine" id="cb29-11" title="11">  first &lt;-<span class="st"> </span><span class="op">!!</span><span class="kw">first</span>()</a>
<a class="sourceLine" id="cb29-12" title="12">  last &lt;-<span class="st"> </span><span class="op">!!</span><span class="kw">last</span>()</a>
<a class="sourceLine" id="cb29-13" title="13">}))</a></code></pre></div>
<pre><code>#&gt; first &lt;- get("pressure", "package:datasets") %&gt;%
#&gt;   head(1L)
#&gt; last &lt;- get("pressure", "package:datasets") %&gt;%
#&gt;   tail(1L)</code></pre>
<p>This duplication of the <code><a href="https://www.rdocumentation.org/packages/base/topics/get">get()</a></code> wouldn’t pass code review, can we extract it into a variable instead?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co"># </span><span class="al">TODO</span><span class="co">: I was forced to redefine first/last because the</span></a>
<a class="sourceLine" id="cb31-2" title="2"><span class="co"># copies in the last code chunk have already cached their</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="co"># inputs, so withDynamicScope has no effect. Consider not</span></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="co"># caching metaReactives at all in meta mode?</span></a>
<a class="sourceLine" id="cb31-5" title="5">first &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>(<span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Fdist">df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(1L))</a>
<a class="sourceLine" id="cb31-6" title="6">last &lt;-<span class="st"> </span><span class="kw"><a href="../reference/metaReactive.html">metaReactive</a></span>(<span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Fdist">df</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(1L))</a>
<a class="sourceLine" id="cb31-7" title="7"></a>
<a class="sourceLine" id="cb31-8" title="8"><span class="kw">expandCode</span>(</a>
<a class="sourceLine" id="cb31-9" title="9">  {</a>
<a class="sourceLine" id="cb31-10" title="10">    mydata &lt;-<span class="st"> </span><span class="op">!!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Fdist">df</a></span>()</a>
<a class="sourceLine" id="cb31-11" title="11">    first &lt;-<span class="st"> </span><span class="op">!!</span><span class="kw">first</span>()</a>
<a class="sourceLine" id="cb31-12" title="12">    last &lt;-<span class="st"> </span><span class="op">!!</span><span class="kw">last</span>()</a>
<a class="sourceLine" id="cb31-13" title="13">  },</a>
<a class="sourceLine" id="cb31-14" title="14">  <span class="dt">patchCalls =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</a>
<a class="sourceLine" id="cb31-15" title="15">    <span class="dt">df =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/substitute">quote</a></span>(mydata)</a>
<a class="sourceLine" id="cb31-16" title="16">  )</a>
<a class="sourceLine" id="cb31-17" title="17">)</a></code></pre></div>
<pre><code>#&gt; mydata &lt;- get("pressure", "package:datasets")
#&gt; first &lt;- mydata %&gt;%
#&gt;   head(1L)
#&gt; last &lt;- mydata %&gt;%
#&gt;   tail(1L)</code></pre>
</div>
<div id="prettifying-code" class="section level2">
<h2 class="hasAnchor">
<a href="#prettifying-code" class="anchor"></a>Prettifying code</h2>
</div>
<div id="turning-code-into-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#turning-code-into-outputs" class="anchor"></a>Turning code into outputs</h2>
<div id="code-preview-pane" class="section level3">
<h3 class="hasAnchor">
<a href="#code-preview-pane" class="anchor"></a>Code preview pane</h3>
</div>
<div id="r-scripts" class="section level3">
<h3 class="hasAnchor">
<a href="#r-scripts" class="anchor"></a>R scripts</h3>
</div>
<div id="rmd-reports" class="section level3">
<h3 class="hasAnchor">
<a href="#rmd-reports" class="anchor"></a>Rmd reports</h3>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#motivation">Motivation</a></li>
      <li><a href="#other-approaches-scriptgloss-phyloseq">Other approaches (scriptgloss, phyloseq)</a></li>
      <li><a href="#demo">Demo</a></li>
      <li><a href="#code">Code</a></li>
      <li><a href="#metaprogramming-with-shiny">Metaprogramming with Shiny</a></li>
      <li><a href="#specifics-of-metaprogramming-with-shiny">Specifics of metaprogramming with Shiny</a></li>
      <li><a href="#combining-multiple-code-objects-into-one-code-block">Combining multiple code objects into one code block</a></li>
      <li><a href="#reducing-code-duplication">Reducing code duplication</a></li>
      <li><a href="#prettifying-code">Prettifying code</a></li>
      <li><a href="#turning-code-into-outputs">Turning code into outputs</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Joe Cheng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
